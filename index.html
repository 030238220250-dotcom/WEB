<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Shop Cơ Bản — Demo</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --accent:#0ea5a4;
      --bg:#f8fafc;
      --card:#ffffff;
      --muted:#6b7280;
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:#111827;}
    .container{max-width:1100px;margin:30px auto;padding:16px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#7dd3fc);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
    .search{flex:1;margin-left:14px}
    .search input{width:100%;padding:10px 12px;border-radius:8px;border:1px solid #e6e9ee}
    .cart-btn{background:var(--card);border:1px solid #e6e9ee;padding:8px 12px;border-radius:8px;cursor:pointer}

    /* grid */
    .grid{display:grid;grid-template-columns:1fr 320px;gap:20px;margin-top:20px}
    @media (max-width:880px){.grid{grid-template-columns:1fr}.cart-panel{order:2}}

    /* product list */
    .products{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
    .card{background:var(--card);border-radius:12px;padding:12px;border:1px solid #eef2f6}
    .card img{width:100%;height:140px;object-fit:cover;border-radius:8px}
    .card h3{margin:8px 0 0;font-size:16px}
    .price{font-weight:700;margin-top:6px}
    .muted{color:var(--muted);font-size:13px}
    .btn{margin-top:10px;padding:8px 10px;border-radius:8px;border:none;background:var(--accent);color:white;cursor:pointer}

    /* cart panel */
    .cart-panel{background:var(--card);border-radius:12px;padding:16px;border:1px solid #eef2f6;height:fit-content}
    .cart-item{display:flex;gap:10px;align-items:center;border-bottom:1px dashed #eef2f6;padding:8px 0}
    .qty{display:flex;gap:6px;align-items:center}
    .qty button{padding:6px 8px;border-radius:6px;border:1px solid #e6e9ee;background:white;cursor:pointer}
    .checkout{margin-top:12px;padding:10px;border-radius:8px;border:none;background:#111827;color:white;width:100%;cursor:pointer}

    footer{margin-top:30px;text-align:center;color:var(--muted);font-size:13px}
    /* small helpers */
    .empty{padding:18px;text-align:center;color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">S</div>
        <div>
          <div style="font-weight:700">Shop Cơ Bản</div>
          <div class="muted" style="font-size:13px">Bán đồ demo — không có thanh toán thật</div>
        </div>
      </div>
      <div class="search">
        <input id="search" placeholder="Tìm sản phẩm... (ví dụ: áo, nón, tai nghe)" />
      </div>
      <div>
        <button id="openCart" class="cart-btn">Giỏ hàng (<span id="cartCount">0</span>)</button>
      </div>
    </header>

    <main class="grid">
      <section>
        <h2>Sản phẩm</h2>
        <div id="products" class="products"></div>
      </section>

      <aside class="cart-panel">
        <h3>Giỏ hàng</h3>
        <div id="cartItems"></div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
          <div class="muted">Tổng</div>
          <div style="font-weight:700" id="cartTotal">₫0</div>
        </div>
        <button id="checkoutBtn" class="checkout">Thanh toán (mô phỏng)</button>
        <div style="margin-top:10px" class="muted">Lưu ý: Đây là demo. Dữ liệu lưu trong localStorage.</div>
      </aside>
    </main>

    <footer>
      © <span id="year"></span> Shop Cơ Bản — Demo học tập
    </footer>
  </div>

  <template id="productTpl">
    <div class="card">
      <img src="" alt="">
      <h3></h3>
      <div class="muted desc"></div>
      <div class="price"></div>
      <button class="btn add">Thêm vào giỏ</button>
    </div>
  </template>

  <script>
    // Dữ liệu mẫu (thêm / thay đổi dễ dàng)
    const PRODUCTS = [
      {id:1,title:'Áo phông Unisex',price:199000,desc:'100% cotton, nhiều màu',img:'https://images.unsplash.com/photo-1520975685381-5b7f9d8f9c3b?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=5c5bdd2c'},
      {id:2,title:'Nón lưỡi trai',price:99000,desc:'Vải chắc chắn, vừa vặn',img:'https://images.unsplash.com/photo-1520975665062-f0a621b6c5f1?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=f3d5e7d3'},
      {id:3,title:'Tai nghe Bluetooth',price:499000,desc:'Pin 20h, kết nối ổn định',img:'https://images.unsplash.com/photo-1518444024803-1c3b5f1f9f94?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=9f4b9a6b'},
      {id:4,title:'Áo khoác nhẹ',price:349000,desc:'Chống gió, phong cách',img:'https://images.unsplash.com/photo-1541099649105-f69ad21f3246?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=2f6b8e6f'},
      {id:5,title:'Túi vải nhỏ',price:79000,desc:'Tiện dụng, nhiều ngăn',img:'https://images.unsplash.com/photo-1600180758890-7b6f7c6c2a0b?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=1b2a5f85'}
    ];

    // helpers
    const formatVND = n => '₫' + n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.')

    // state
    let state = { cart: {} }

    // load from localStorage
    const saved = localStorage.getItem('simple_shop_cart')
    if(saved){ try{ state.cart = JSON.parse(saved) }catch(e){ state.cart = {} } }

    // render products
    const productsEl = document.getElementById('products')
    const tpl = document.getElementById('productTpl')
    function renderProducts(list){
      productsEl.innerHTML = ''
      list.forEach(p=>{
        const node = tpl.content.cloneNode(true)
        node.querySelector('img').src = p.img
        node.querySelector('img').alt = p.title
        node.querySelector('h3').textContent = p.title
        node.querySelector('.desc').textContent = p.desc
        node.querySelector('.price').textContent = formatVND(p.price)
        node.querySelector('.add').addEventListener('click', ()=> addToCart(p.id))
        productsEl.appendChild(node)
      })
    }

    // search
    document.getElementById('search').addEventListener('input', e=>{
      const q = e.target.value.trim().toLowerCase()
      if(!q) renderProducts(PRODUCTS)
      else renderProducts(PRODUCTS.filter(p=> (p.title + ' ' + p.desc).toLowerCase().includes(q)))
    })

    // cart functions
    function addToCart(productId){
      const pid = String(productId)
      if(!state.cart[pid]) state.cart[pid] = {id:productId,qty:0}
      state.cart[pid].qty += 1
      save()
      renderCart()
      flashCartCount()
    }
    function removeFromCart(productId){
      delete state.cart[String(productId)]
      save(); renderCart()
    }
    function changeQty(productId, delta){
      const pid = String(productId)
      if(!state.cart[pid]) return
      state.cart[pid].qty += delta
      if(state.cart[pid].qty <= 0) removeFromCart(productId)
      save(); renderCart()
    }
    function save(){ localStorage.setItem('simple_shop_cart', JSON.stringify(state.cart)) }

    function cartSummary(){
      let total = 0, count = 0
      for(const k in state.cart){
        const item = state.cart[k]
        const prod = PRODUCTS.find(p=>p.id===item.id)
        if(!prod) continue
        total += prod.price * item.qty
        count += item.qty
      }
      return { total, count }
    }

    function renderCart(){
      const el = document.getElementById('cartItems')
      el.innerHTML = ''
      const keys = Object.keys(state.cart)
      if(keys.length===0){ el.innerHTML = '<div class="empty">Giỏ hàng trống</div>' }
      keys.forEach(k=>{
        const item = state.cart[k]
        const prod = PRODUCTS.find(p=>p.id===item.id)
        if(!prod) return
        const node = document.createElement('div')
        node.className = 'cart-item'
        node.innerHTML = `
          <img src="${prod.img}" style="width:52px;height:52px;object-fit:cover;border-radius:6px" />
          <div style="flex:1">
            <div style="font-weight:600">${prod.title}</div>
            <div class="muted">${formatVND(prod.price)}</div>
          </div>
          <div style="text-align:right">
            <div class="qty">
              <button data-action="minus">-</button>
              <div style="min-width:26px;text-align:center">${item.qty}</div>
              <button data-action="plus">+</button>
            </div>
            <div style="margin-top:6px;font-weight:700">${formatVND(prod.price * item.qty)}</div>
            <div style="margin-top:6px"><button data-action="remove" style="border:none;background:none;color:#ef4444;cursor:pointer">Xóa</button></div>
          </div>
        `
        node.querySelector('[data-action="plus"]').addEventListener('click', ()=> changeQty(prod.id,1))
        node.querySelector('[data-action="minus"]').addEventListener('click', ()=> changeQty(prod.id,-1))
        node.querySelector('[data-action="remove"]').addEventListener('click', ()=> removeFromCart(prod.id))
        el.appendChild(node)
      })
      const {total,count} = cartSummary()
      document.getElementById('cartTotal').textContent = formatVND(total)
      document.getElementById('cartCount').textContent = count
    }

    // checkout (mô phỏng)
    document.getElementById('checkoutBtn').addEventListener('click', ()=>{
      const {count,total} = cartSummary()
      if(count===0){ alert('Giỏ hàng trống!') ; return }
      // đơn giản: hỏi thông tin khách hàng cơ bản
      const name = prompt('Tên người nhận:')
      if(!name) return alert('Vui lòng nhập tên.')
      const dress = prompt ('Nhập địa chỉ.')
      if(!dress) return alert ('Vui lòng nhập địa chỉ')
      const phone = prompt('Số điện thoại:')
      if(!phone) return alert('Vui lòng nhập số điện thoại.')
      // tạo object đơn hàng
const order = {
  name,
  phone,
  total,
  items: Object.values(state.cart).map(item => {
    const prod = PRODUCTS.find(p => p.id === item.id)
    return {
      title: prod.title,
      qty: item.qty,
      price: prod.price
    }
  })
};

// gửi tới Google Sheet
fetch("https://script.google.com/macros/s/AKfycbzR-MdwvekxO1ETgKWAL264TyBiKYPb2DMHAJKJ3sVGuug7mMCFer_ffWH3NauuLVzS/exec", {
  method: "POST",
  body: JSON.stringify(order),
  headers: { "Content-Type": "application/json" }
})
.then(res => res.text())
.then(txt => {
  alert("Đặt hàng thành công! Cảm ơn " + name);
  state.cart = {}; save(); renderCart();
})
.catch(err => {
  console.error(err);
  alert("Có lỗi khi gửi đơn hàng, vui lòng thử lại!");
});

    })

    // small UX: open cart focus
    document.getElementById('openCart').addEventListener('click', ()=>{
      window.scrollTo({ top: document.querySelector('.cart-panel').offsetTop - 20, behavior: 'smooth' })
    })

    // little flash when added
    function flashCartCount(){
      const el = document.getElementById('cartCount')
      el.style.transition = 'transform 0.18s'
      el.style.transform = 'scale(1.3)'
      setTimeout(()=> el.style.transform = 'scale(1)',180)
    }

    // init
    document.getElementById('year').textContent = new Date().getFullYear()
    renderProducts(PRODUCTS)
    renderCart()

    // keyboard: press "c" to open cart
    window.addEventListener('keydown', e=>{ if(e.key === 'c'){ document.getElementById('openCart').click() } })
  </script>
</body>
</html> 